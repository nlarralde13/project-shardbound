<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shard Editor (2D)</title>
  <link rel="stylesheet" href="./editor/shard-editor.css?v=4" />
</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="title">Shard Editor (2D Grid)</div>
      <div class="spacer"></div>
      <div class="toolbar">
        <label class="file-btn"><input type="file" id="fileInput" accept=".json" /><span>Load JSON</span></label>
        <button id="fetchBtn" title="Fetch shard JSON from URL">Fetch</button>
        <input id="fetchUrl" placeholder="/static/src/data/worlds/core_world/shards/A_0.json" />
        <button id="saveBtn">Download JSON</button>
        <a id="docsLink" href="/static/src/dev/rng-test.html" target="_blank" rel="noopener" class="link">RNG Test</a>
      </div>
    </header>

    <main>
      <div class="left">
        <div class="canvasWrap">
          <canvas id="grid"></canvas>
          <div id="tooltip"></div>
          <div id="banner" class="banner hidden"></div>

          <div id="zoomUI" class="zoomOverlay">
            <button id="fitBtn"  title="Fit (F)"  class="zoomBtn">Fit</button>
            <button id="zinBtn"  title="Zoom In (+)" class="zoomBtn">+</button>
            <button id="zoutBtn" title="Zoom Out (-)" class="zoomBtn">−</button>
          </div>
        </div>
        <div class="status"><span id="statusText">Ready.</span></div>
      </div>

      <aside class="right">
        <details open class="panel">
          <summary class="panelTitle">Brush</summary>
          <label>Biome <select id="biomePick"></select></label>
          <label>Brush Size <input id="brushSize" type="number" min="1" max="9" step="1" value="1" /></label>
          <div class="hint">LMB paint · RMB/Middle drag pan · Wheel zoom at cursor · Shift+drag rectangle (visual only)</div>
        </details>

        <details open class="panel">
          <summary class="panelTitle">World</summary>
          <div class="grid2">
            <!-- DEFAULTS: 64×64 -->
            <label>Width  <input id="regenW" type="number" min="4" max="500" value="64" /></label>
            <label>Height <input id="regenH" type="number" min="4" max="500" value="64" /></label>
            <label>Seed   <input id="regenSeed" type="number" value="0" /></label>
            <label>Preset <select id="regenPreset">
              <option value="default">default</option>
              <option value="archipelago">archipelago</option>
              <option value="continents">continents</option>
              <option value="islands">islands</option>
            </select></label>
          </div>
          <div class="btnRow"><button id="regenBtn">Regenerate</button></div>
        </details>

        <details open class="panel">
          <summary class="panelTitle">Tile Metadata</summary>
          <div class="grid2">
            <label>Biome <input id="metaBiome" /></label>
            <label>Seed <input id="metaSeed" type="number" /></label>
            <label>Tier <input id="metaTier" type="number" min="0" max="20" step="1" /></label>
            <label>Owner <input id="metaOwner" placeholder="neutral/alliance/..." /></label>
            <label>Passable <input id="metaPassable" type="checkbox" /></label>
            <label>Tags (CSV) <input id="metaTags" placeholder="coastal, ridge" /></label>
          </div>
          <div class="panelSub">Slice Options</div>
          <div class="grid2">
            <label>mob_density <input id="optMob" type="number" step="0.01" min="0" max="1" /></label>
            <label>dungeon_chance <input id="optDungeon" type="number" step="0.001" min="0" max="1" /></label>
            <label>can_spawn_elite <input id="optElite" type="checkbox" /></label>
            <label>elite_rate <input id="optEliteRate" type="number" step="0.01" min="0" max="1" /></label>
            <label>can_spawn_fish <input id="optFish" type="checkbox" /></label>
            <label>fish_density <input id="optFishDen" type="number" step="0.01" min="0" max="1" /></label>
            <label>boat_allowed <input id="optBoat" type="checkbox" /></label>
            <label>oil_seeps <input id="optOil" type="checkbox" /></label>
            <label>coral_present <input id="optCoral" type="checkbox" /></label>
            <label>pearl_rate <input id="optPearl" type="number" step="0.01" min="0" max="1" /></label>
            <label>resources (CSV) <input id="optResources" placeholder="wood, ore" /></label>
            <label>subtype <input id="optSubtype" placeholder="temperate, shelf, ..." /></label>
          </div>
          <div class="btnRow"><button id="applyMeta">Apply to Selected</button><button id="defaultsMeta">Biome Defaults</button></div>
          <div class="btnRow"><button id="undoBtn">Undo</button><button id="redoBtn">Redo</button></div>
        </details>
      </aside>
    </main>
  </div>

  <script type="module">
    import { startShardEditor } from './editor/shardEditorApp.js?v=5';
    startShardEditor({
      biomeRegistryPath: '/static/src/data/biomeRegistry.js',
      defaultShardUrl:   '/static/src/data/worlds/core_world/shards/A_0.json',
      // Your repo layout:
      //   editor JS: /static/src/dev/editor/shardEditorApp.js
      //   worldgen : /static/src/dev/shards/rdmShardGen.js  (example)
      // If you move rdmShardGen, just change this path:
      worldgenPath:      '../../shards/rdmShardGen.js'
    });
  </script>
</body>
</html>
