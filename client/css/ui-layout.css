/* ==========================================================================
   Shardbound — Layout Sandbox CSS
   - Clean tokens
   - Fixed banner height via --banner-h
   - Bounded playfield (docked grid / free absolute)
   - Square map frame (shard fills fully)
   - User chip & menu
   - Guides, snap grid, buttons, panel polish
   ========================================================================== */

/* ===== TOKENS & GLOBALS ===== */
:root{
  /* theme */
  --bg:#0b0a11; --panel:#13111b; --ink:#e9e4d8; --muted:#b8b2a4;
  --line:#2a2740; --gold:#d4a64e; --rune:#62c0ff;

  /* layout */
  --banner-h:48px;           /* ← set me to 64/72/etc to resize banner */
  --pf-pad:12px;             /* inner padding for playfield */
  --snap:24px;               /* default pixel snap (JS may override) */
  --map-side: clamp(480px, 32vw, 860px);  /* square map panel width */

  /* components */
  --slot:64px; --gap:10px; --radius:12px;
  --gold-glow:0 0 18px rgba(212,166,78,.35);
}

*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; }

body.theme-fantasy{
  color:var(--ink);
  background:
    radial-gradient(1200px 800px at 50% -20%, rgba(98,192,255,.06), transparent 60%),
    radial-gradient(800px 600px at 80% 120%, rgba(212,166,78,.08), transparent 60%),
    var(--bg);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

.muted{ color:var(--muted); font-size:13px; }

/* ===== CARDS ===== */
.card{
  position:relative; background:var(--panel);
  border:1px solid var(--line); border-radius:14px;
  padding:12px; margin:10px 8px;
  box-shadow:0 6px 20px rgba(0,0,0,.45), 0 1px 0 rgba(255,255,255,.03) inset;
}
.card-h{
  display:flex; align-items:center; gap:8px;
  font-family:"Cinzel", serif; font-weight:700; color:#ffe6b3; margin:0 0 10px;
}
.card-h::after{
  content:""; flex:1 1 auto; height:1px;
  background:linear-gradient(90deg, rgba(212,166,78,.5), transparent);
}

/* Small chevron used by panels.js "collapse" */
.panel-toggle{
  margin-left:auto; background:none; border:0; color:var(--ink);
  opacity:.85; display:inline-flex; align-items:center; cursor:pointer;
}
.panel[data-collapsed="1"] .panel-toggle svg{ transform: rotate(180deg); }

/* ===== BANNER ===== */
#banner{
  position:fixed; left:0; right:0; top:0; height:var(--banner-h);
  z-index:20; display:flex; align-items:center; gap:12px; padding:8px 12px;
  background:linear-gradient(180deg, rgba(0,0,0,.15), transparent);
}
#banner .brand{
  font-family:"Cinzel", serif; font-weight:700; letter-spacing:.5px; color:#ffe6b3; font-size:18px;
}
#banner .spacer{ flex:1; }

/* ===== USER CHIP ===== */
#banner { gap: 12px; }
.user-chip { position: relative; display: flex; align-items: center; }
.user-chip-btn{
  display:flex; align-items:center; gap:10px; padding:6px 10px; border-radius:12px;
  background: linear-gradient(180deg,#1a1723,#12101a); border:1px solid var(--line);
  color: var(--ink); box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.user-chip-btn:hover{ border-color: var(--gold); box-shadow: var(--gold-glow), inset 0 0 0 1px rgba(255,255,255,.06); }
.user-chip-btn:focus-visible{ outline: 2px solid #60a5fa; outline-offset: 2px; }
.user-chip .avatar{
  position: relative; width:36px; height:36px; border-radius:50%; overflow:hidden; display:inline-grid; place-items:center;
  background: radial-gradient(60% 60% at 35% 35%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  box-shadow: 0 0 0 2px rgba(212,166,78,.35), inset 0 0 0 1px rgba(255,255,255,.04);
}
.user-chip .avatar img{ display:block; width:100%; height:100%; object-fit:cover; }
.user-chip .initials{
  position:absolute; inset:0; display:grid; place-items:center; font:700 13px/1 "Cinzel", serif; color:#ffe6b3; text-shadow:0 1px 0 #2a1f0c;
}
.user-chip .status-dot{
  position:absolute; right:-2px; bottom:-2px; width:12px; height:12px; border-radius:50%;
  background:#2ecc71; box-shadow:0 0 0 2px #12101a, 0 0 10px rgba(46,204,113,.5);
}
.user-chip .label{ display:flex; flex-direction:column; line-height:1.05; }
.user-chip .hello{ font:600 10px/1 "Cinzel", serif; color:#c9e6ff; opacity:.9; }
.user-chip .name{ font:700 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:#e9e4d8; }
.user-chip .chev{ opacity:.7; transition: transform .15s ease; }
.user-chip-btn[aria-expanded="true"] .chev{ transform: rotate(180deg); }

.user-menu{
  position:absolute; right:0; top:calc(100% + 8px);
  min-width: 200px; background:#13111b; border:1px solid var(--line); border-radius:12px; padding:6px;
  box-shadow: 0 16px 48px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.03) inset;
}
.user-menu a, .user-menu button{
  display:block; width:100%; text-align:left; padding:8px 10px; border-radius:8px; border:0; background:transparent; color:#e9e4d8;
  font: 600 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; cursor:pointer;
}
.user-menu a:hover, .user-menu button:hover{ background: rgba(255,255,255,.06); }
.user-menu form{ margin:0; }
.user-menu .menu-sep { height: 1px; margin: 6px 4px; background: rgba(255,255,255,.06); }
.user-menu .group-label { padding: 6px 10px; font: 700 11px/1 "Cinzel", serif; color: #c9e6ff; opacity: .9; }

/* ===== BOUNDED PLAYFIELD ===== */
#playfield{
  position:fixed; left:0; right:0;
  top:calc(var(--banner-h, 48px));  /* safe fallback */
  bottom:0; padding:var(--pf-pad, 12px);
  overflow:hidden; z-index:10;
}

/* Docked (grid) layout by default */
#playfield.docked{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  grid-auto-rows: minmax(160px, auto);
  gap:12px;
}

/* Free layout: panels absolute within playfield */
#playfield.free { display:block; }
#playfield.free .panel{ position:absolute; margin:0; }
#playfield.free .panel .card-h { cursor: grab; }
#playfield.free .panel.dragging .card-h { cursor: grabbing; }
#playfield .panel.dragging{ box-shadow: 0 0 0 2px rgba(212,166,78,.35), 0 16px 48px rgba(0,0,0,.6); }
#playfield .panel .card-h{ user-select:none; }

/* Snap grid overlay (visual aid only) */
#snapGrid{
  position:absolute; inset:0; z-index:0; pointer-events:none;
  background-image:
    linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
  background-size: var(--snap) var(--snap);
  opacity:.06; transition:opacity .2s ease;
}
#playfield.free #snapGrid{ opacity:.18; }

/* Alignment guides (drawn by panels.js) */
.guide {
  position: absolute; z-index: 50; pointer-events: none;
  background: rgba(212,166,78,.7);
  box-shadow: 0 0 0 1px rgba(0,0,0,.35);
}
.guide.v { width: 2px; height: 100%; top: 0; }
.guide.h { height: 2px; width: 100%; left: 0; }

/* ===== MAP PANEL (square frame) ===== */
.map-card{ width: var(--map-side); }

.canvas-wrap{
  background:linear-gradient(180deg,#1b1a23,#0e0d13);
  border:1px solid var(--line); border-radius:14px;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.03), 0 10px 30px rgba(0,0,0,.5);
  padding:10px;
}

#frame{
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;      /* force square so a 1:1 shard fills */
  height: auto;
  overflow: hidden;
  background:radial-gradient(60% 60% at 30% 40%, rgba(255,255,255,.04), transparent 60%), #101018;
  border-radius:10px; border:1px solid var(--line);
}

#frame > canvas{
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  display: block;
  image-rendering: pixelated; /* crisp tiles */
}

/* ===== ACTIONS / BUTTONS ===== */
.action-dock{ width:200px; }
.quick-actions{ display:flex; flex-direction:column; gap:10px; }
.btn{
  padding:10px 12px; border-radius:10px; border:1px solid var(--line);
  background:linear-gradient(180deg,#1a1723,#12101a);
  color:#ffe6b3; text-shadow:0 1px 0 #2a1f0c; box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.btn:hover{ border-color:var(--gold); box-shadow:var(--gold-glow), inset 0 0 0 1px rgba(255,255,255,.06); }

/* ===== CHARACTER / INVENTORY placeholders (for parity while sandboxing) ===== */
.char-grid{ display:grid; grid-template-columns:1fr; grid-template-rows:auto auto; gap:6px; }
.paperdoll{ padding:8px; }
.paperdoll-stage{
  position:relative;
  width: calc(var(--slot)*3 + var(--gap)*2);
  height: calc(var(--slot)*3 + var(--gap)*2);
  margin:0 auto;
  background: radial-gradient(80% 80% at 50% 30%, rgba(255,255,255,.05), transparent 60%), linear-gradient(180deg, #14121c, #0f0d16);
  border:1px solid var(--line); border-radius:12px; box-shadow: inset 0 0 60px rgba(0,0,0,.45);
}
.paperdoll-stage::before{
  content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:240px; height:240px; border-radius:50%;
  background: repeating-conic-gradient(from 0deg, rgba(98,192,255,.25) 0 4deg, transparent 4deg 12deg),
             radial-gradient(closest-side, rgba(98,192,255,.18), rgba(98,192,255,.04) 60%, transparent 70%);
  pointer-events:none; filter:blur(.2px);
}
.doll-image{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); max-width:180px; max-height:220px; image-rendering:pixelated; filter:drop-shadow(0 8px 18px rgba(0,0,0,.45)); }

.paperdoll-grid{
  position:absolute; inset:0;
  display:grid; grid-template-columns:repeat(3, var(--slot)); grid-template-rows:repeat(3, var(--slot));
  gap:var(--gap); place-items:center;
}
.equip-slot{
  width:var(--slot); height:var(--slot);
  border-radius:12px; border:1px solid var(--line);
  background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  display:grid; place-items:center; transition:.08s transform, .12s box-shadow, .12s border-color;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
  position:relative;
}
.equip-slot::after{ content:attr(aria-label); position:absolute; left:7px; bottom:6px; font:600 10px/1 "Cinzel", serif; color:#c9e6ff; opacity:.85; text-shadow:0 1px 0 #08111a; }
.equip-slot[data-slot="head"]     { grid-column:2; grid-row:1; }
.equip-slot[data-slot="cloak"]    { grid-column:1; grid-row:1; }
.equip-slot[data-slot="offhand"]  { grid-column:3; grid-row:1; }
.equip-slot[data-slot="chest"]    { grid-column:1; grid-row:2; }
.equip-slot[data-slot="mainhand"] { grid-column:3; grid-row:2; }
.equip-slot[data-slot="belt"]     { grid-column:1; grid-row:3; }
.equip-slot[data-slot="pants"]    { grid-column:2; grid-row:3; }
.equip-slot[data-slot="boots"]    { grid-column:3; grid-row:3; }
.equip-slot[data-slot="jewelry"]  { grid-column:2; grid-row:1; justify-self:end;   transform:translateX(-78px); }
.equip-slot[data-slot="gadget"]   { grid-column:2; grid-row:1; justify-self:start; transform:translateX( 78px); }

.sub-h{ font:700 13px "Cinzel", serif; color:#ffe6b3; margin:10px 0 8px; text-align:center; }
.inventory-grid{
  --cell: var(--slot);
  display:grid; grid-template-columns: repeat(4, var(--cell)); gap:10px; align-content:start; justify-content:center;
}
.inventory-grid .inv-cell{
  width:var(--cell); height:var(--cell);
  border-radius:12px; border:1px solid var(--line);
  background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  overflow:hidden; position:relative; box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
/* === Dev Tray === */
.dev-grid{
  --cell: 64px;
  display:grid;
  grid-template-columns: repeat(4, var(--cell));
  gap:10px;
}
.dev-item{
  width:var(--cell); height:var(--cell);
  border-radius:12px; border:1px solid var(--line);
  background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  display:grid; place-items:center; overflow:hidden; cursor:grab;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.dev-item:active{ cursor:grabbing; }
.dev-item img{ width:100%; height:100%; object-fit:contain; image-rendering:pixelated; }
