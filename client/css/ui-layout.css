/* ===== TOKENS ===== */
:root{
  --bg:#0b0a11; --panel:#13111b; --ink:#e9e4d8; --muted:#b8b2a4;
  --line:#2a2740; --gold:#d4a64e; --rune:#62c0ff;
  --slot:64px; --gap:10px; --radius:12px;
  --gold-glow:0 0 18px rgba(212,166,78,.35);
}
body.theme-fantasy{
  color:var(--ink);
  background:
    radial-gradient(1200px 800px at 50% -20%, rgba(98,192,255,.06), transparent 60%),
    radial-gradient(800px 600px at 80% 120%, rgba(212,166,78,.08), transparent 60%),
    var(--bg);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

/* ===== LAYOUT ===== */
#layout{
  display:grid;
  grid-template-columns: 380px 1fr 360px;
  grid-template-rows: auto 1fr;
}
#panel-left{padding:10px; border-right:1px solid var(--line);}
#panel-right{padding:10px; border-left:1px solid var(--line);}
#viewport{display:flex; flex-direction:column; align-items:center; gap:12px; padding:10px 0;}
.viewer-row{
  display:grid;
  grid-template-columns: 720px 200px; /* map + actions */
  gap:12px; align-items:start;
}

/* ===== CARDS ===== */
.card{
  position:relative; background:#13111b;
  border:1px solid var(--line); border-radius:14px; padding:12px; margin:10px 8px;
  box-shadow:0 6px 20px rgba(0,0,0,.45), 0 1px 0 rgba(255,255,255,.03) inset;
}
.card-h{font-family:"Cinzel", serif; font-weight:700; color:#ffe6b3; margin:0 0 10px;}
.card-h::after{content:""; display:inline-block; height:1px; background:linear-gradient(90deg, rgba(212,166,78,.5), transparent); width:100%; margin-left:8px; vertical-align:middle}

/* ===== MAP (contained) ===== */
.map-card{ width:720px; }
.canvas-wrap{ background:linear-gradient(180deg,#1b1a23,#0e0d13); border:1px solid var(--line); border-radius:14px; box-shadow: inset 0 0 0 2px rgba(255,255,255,.03), 0 10px 30px rgba(0,0,0,.5); }
#frame{ width:720px; height:512px; overflow:hidden; position:relative; }
#frame canvas{ display:block; width:100%; height:100%; background:transparent; }
.zoomOverlay{
  position:absolute; right:8px; bottom:8px; display:flex; gap:6px; z-index:10;
}
.zbtn{
  width:32px; height:32px; line-height:32px; text-align:center;
  border-radius:8px; border:1px solid var(--line);
  background: radial-gradient(circle at 50% 35%, rgba(255,255,255,.06), transparent 60%), #16141f;
  color:#e7d7b3; text-shadow:0 1px 0 #2a1f0c; box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.zbtn:hover{ box-shadow: var(--gold-glow), inset 0 0 0 1px rgba(255,255,255,.06); }

/* ===== ACTION DOCK ===== */
.action-dock{ position:sticky; top:10px; width:200px; }
.quick-actions{ display:flex; flex-direction:column; gap:10px; }
.btn{
  padding:10px 12px; border-radius:10px; border:1px solid var(--line);
  background:linear-gradient(180deg,#1a1723,#12101a);
  color:#ffe6b3; text-shadow:0 1px 0 #2a1f0c;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.btn:hover{ border-color:var(--gold); box-shadow:var(--gold-glow), inset 0 0 0 1px rgba(255,255,255,.06); }

/* ===== CONSOLE aligned to map width ===== */
.console-card{ width:720px; }
#console-root{
  min-height:110px; border:1px solid var(--line); border-radius:10px;
  background:linear-gradient(180deg,#0d0c13,#0b0a11);
  font-family:ui-monospace,monospace; color:#e9e4d8; padding:8px;
}

/* ===== CHARACTER: paperdoll + inventory ===== */
.char-grid{ display:grid; grid-template-columns: 1fr; grid-template-rows:auto auto; gap:6px; }

/* Paperdoll stage */
.paperdoll{ padding:8px; }
.paperdoll-stage{
  position:relative;
  width: calc(var(--slot)*3 + var(--gap)*2);
  height: calc(var(--slot)*3 + var(--gap)*2);
  margin:0 auto;
  background: radial-gradient(80% 80% at 50% 30%, rgba(255,255,255,.05), transparent 60%), linear-gradient(180deg, #14121c, #0f0d16);
  border:1px solid var(--line); border-radius:12px; box-shadow: inset 0 0 60px rgba(0,0,0,.45);
}
.paperdoll-stage::before{
  content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:240px; height:240px; border-radius:50%;
  background: repeating-conic-gradient(from 0deg, rgba(98,192,255,.25) 0 4deg, transparent 4deg 12deg),
             radial-gradient(closest-side, rgba(98,192,255,.18), rgba(98,192,255,.04) 60%, transparent 70%);
  pointer-events:none; filter:blur(.2px);
}
.doll-image{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); max-width:180px; max-height:220px; image-rendering:pixelated; filter:drop-shadow(0 8px 18px rgba(0,0,0,.45)); }

/* 3×3 ring grid around the doll */
.paperdoll-grid{
  position:absolute; inset:0;
  display:grid; grid-template-columns:repeat(3, var(--slot)); grid-template-rows:repeat(3, var(--slot));
  gap:var(--gap); place-items:center;
}
.equip-slot{
  width:var(--slot); height:var(--slot);
  border-radius:12px; border:1px solid var(--line);
  background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  display:grid; place-items:center; transition:.08s transform, .12s box-shadow, .12s border-color;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
  position:relative;
}
.equip-slot img{ width:100%; height:100%; object-fit:contain; image-rendering:pixelated; pointer-events:none; }
.equip-slot.busy{ outline:1px solid #ffc10755; filter:saturate(.65); }
.equip-slot.reject{ animation: rej .35s; }
@keyframes rej { 0%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} 100%{transform:translateX(0)} }
.equip-slot::after{ content:attr(aria-label); position:absolute; left:7px; bottom:6px; font:600 10px/1 "Cinzel", serif; color:#c9e6ff; opacity:.85; text-shadow:0 1px 0 #08111a; }

/* ring positions */
.equip-slot[data-slot="head"]     { grid-column:1; grid-row:1; }
.equip-slot[data-slot="cloak"]    { grid-column:2; grid-row:2; }
.equip-slot[data-slot="offhand"]  { grid-column:3; grid-row:3; }
.equip-slot[data-slot="chest"]    { grid-column:4; grid-row:4; }
.equip-slot[data-slot="mainhand"] { grid-column:1; grid-row:1; }
.equip-slot[data-slot="belt"]     { grid-column:1; grid-row:1; }
.equip-slot[data-slot="pants"]    { grid-column:1; grid-row:1; }
.equip-slot[data-slot="boots"]    { grid-column:1; grid-row:1; }
/* “ear” slots flanking the head */
.equip-slot[data-slot="jewelry"]  { grid-column:1; grid-row:1;  }
.equip-slot[data-slot="gadget"]   { grid-column:3; grid-row:4;  }

/* Inventory under the doll */
.sub-h{ font:700 13px "Cinzel", serif; color:#ffe6b3; margin:10px 0 8px; text-align:center; }
.inventory-grid{
  --cell: var(--slot);
  display:grid; grid-template-columns: repeat(4, var(--cell)); gap:10px; align-content:start; justify-content:center;
}
.inventory-grid .inv-cell{
  width:var(--cell); height:var(--cell);
  border-radius:12px; border:1px solid var(--line); background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.06), transparent 60%), #0f0d16;
  overflow:hidden; position:relative; box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.inventory-grid .inv-cell img{ width:100%; height:100%; object-fit:contain; image-rendering:pixelated; pointer-events:none; }
.inventory-grid .inv-cell .qty{
  position:absolute; right:6px; bottom:4px; padding:0 6px; border-radius:6px;
  font:700 12px/18px ui-monospace, monospace; color:#18161f; background:#e8dfc8; border:1px solid rgba(0,0,0,.35);
}


/* ---- Free layout toggle button in topbar ---- */
#topbar .link-btn{
  background: none; border: 0; color: #8fb3ff; cursor: pointer; margin-left: 8px;
  font: inherit; padding: 2px 6px;
}
#topbar .link-btn:hover{ text-decoration: underline; }

/* ---- Floating panel mode ---- */
body[data-free-layout="1"] #layout{ display: block; }          /* disable grid */
body[data-free-layout="1"] .panel{ position: fixed; margin: 0; }
body[data-free-layout="1"] .card-h{ cursor: move; user-select: none; }

.panel.dragging{
  box-shadow: 0 0 0 2px rgba(212,166,78,.35), 0 16px 48px rgba(0,0,0,.6);
}
